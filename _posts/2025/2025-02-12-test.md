---
layout  : post
title   : Are you using Redis properly?
summary : Redis, 제대로 활용하고 있나요?
date    : 2025-02-25 11:08:00 +0900
tag     : redis
resource: CE/7B98C2-F86D-46A9-949B-56BAA0135AF6
toc     : true
comment : true
public  : true
---
* TOC
{:toc}

## Introduction

많은 개발자들이 Redis를 사용하지만, 주로 토큰 저장, 조회 및 캐싱 정도로만 활용하고 있는 경우를 많이 경험했습니다.

저의 경우 회사의 서비스에 유저가 많아지며 점점 트래픽으로 인한 서버의 퍼포먼스(메트릭)가 떨어질때, 문제해결 방법을 찾으면서 Redis에 대한 학습 필요성을 느꼈습니다.

학습후에 든 생각은 Redis의 **다양한 자료구조와 내부 동작**을 깊이 이해하고 알았더라면, Redis의 높은 성능과 다양한 기능을 활용하여 좀 더 쉽고 효율적으로 문제를 해결할 수 있었을텐데 라는것 입니다.

## Redis: A Reliable Supporting Actor for Relational Databases

관계형 데이터베이스는 수십 년간 검증된 신뢰할 수 있는 주연(히어로)입니다. 하지만, 대규모 트래픽의 경우 모든 요청과 연산을 RDB에 맡기다 보면 부하가 커지고 성능 저하가 발생할 수 있습니다. 이때 Redis는 데이터베이스의 부담을 덜어주는 조연(서포터) 역할을 수행합니다.

- Redis를 적절히 활용하면, **데이터베이스의 부하를 줄이고 응답 속도를 개선**할 수 있습니다.
- 하지만 Redis는 **메모리**라는 값 비싼 자원을 사용합니다. 따라서, 모든 데이터를 Redis에 저장하는 것이 정답은 아니며, 효율적인 전술이 필요합니다.

## Common Issues When Using Redis Without Deep Understanding

Redis에 대한 이해가 부족한채로 사용하다보면 다음과 같은 문제를 겪을 수 있습니다.

- **문제 발생**시 빠른 시간내에 원인을 찾지 못함
- Redis **장애 상황에 대비**한 코드가 존재하지 않음
    - 많은 경우 Redis 장애 상황에 대비한 코드가 없는 경우를 보았습니다. 장애 상황에 대비한 코드가 존재하지 않다는 것은 곧 Redis 예외에 대한 **예외 마스킹(Exception Masking)**이 되어있지 않다는 것 또한 의미합니다.
    - 장애에 대비한 정상흐름(eg RDB 조회, Redis Sentinel)으로 바꿔주는 코드가 없다면, Redis를 빠르게 복구해야합니다. 이때 마스킹이 되어있지 않다면 엄한 부분을 의심하게 되고 이것은 곧 장애 복구시간이 길어지는 경험을 하게 될 것입니다.
- Redis의 **리소스 사용량**을 예측하지 못함
    - 적절한 리소스 계산 없이 운영하면 필요 이상의 큰 인스턴스를 할당해 불필요한 비용이 지불하게될 수 있습니다.
    - 또한 부적절한 TTL, 캐쉬 삭제 알고리즘 설정을 하지못해 예기치 못한 오류를 겪을 수 있습니다.
- Redis가 **제공하는 기능**을 활용하지 못함
    - Redis에는 다양한 문제를 해결할 수 있는 기능이 있지만, 이를 모르고 다른 기술을 도입하여 불필요한 복잡성을 만드는 경우가 많습니다.
    - 예를 들어 내 위치를 기준으로 일정 반경의 주변의 맛집을 검색하는 API를 만드는데 RDB를 기반으로 구현한다면 다소 복잡한 구현 및 GeoHash 활용이 까다롭습니다. 이럴때 Redis에서 제공하는 Geofencing 기능을 알고있다면 간단하게 위치기반 서비스를 구현할 수 있을 것 입니다.

## Why Understanding Redis Datastructures is Important

Redis를 단순한 SET, GET 커맨드로만 사용하는 경우가 많습니다.

하지만, Redis는 String, List, Set, Sorted Set, Hash, HyperLogLog, Bitmaps, Geo와 같은 다양한 자료구조를 지원합니다. 각 자료구조는 대표적으로 활용되는 케이스들이 존재합니다.

- String: 일반적인 key-value 캐싱 (eg 토큰 저장)
- List: FIFO(Queue) 또는 LIFO(Stack) 구조 활용 (eg 메시지 큐)
- Set: 중복 없는 데이터 저장 (eg 실시간 접속 유저 목록)
- Sorted Set: 순위 기반 데이터 저장 (eg 랭킹보드)
- HyperLogLog: 대량의 고유 값 개수 추정 (eg DAU 계산)
- Bitmaps: 특정 값의 ON/OFF 저장 (eg 유저 출석 체크)
- Geo: 위치 기반 데이터 처리 (eg 반경 내 맛집 검색)

Redis의 자료구조는 문제해결을 위한 알고리즘을 만들기에 충분합니다. 어떤 자료구조를 지원하는지 숙지하고 있다면, 같은 기능이라도 RDB 기반 구현보다 몇 배 빠르게 만들 수 있는 경우가 있습니다. 또한 이미 Redis를 사용하고 있는데 불필요한 기술스택을 추가하는 경우도 생기지 않습니다.

## How to Learn Redis and What You Can Gain

- **공식 문서** 보기
    - 모든 기술은 공식 문서가 정답이라고 할 수 있습니다.
    - Redis의 권장 사용법과 최신 기능을 알 수 있고, 잘못된 사용법을 방지할 수 있습니다.
- **실전 프로젝트** 적용
    - 다양한 Redis 자료구조를 활용하여 직접 프로젝트에 적용해 봅니다.
    - 예를 들어, Sorted Set을 이용해 랭킹 시스템을 구현하거나, HyperLogLog를 사용해 효율적인 유니크 카운팅을 해볼 수 있습니다.
    - 이것으로 회사에서 새롭게 서비스하거나, 개선시킬 부분에 대해서 적용할 수 있는 다양한 케이스를 알게됩니다.
- **성능 테스트** 진행
    - Ngrinder, Jmeter, K6와 같은 테스트 툴을 활용해 Redis 활용 전과 후의 성능을 분석하고 최적화 방법을 찾아봅니다.
    - 실제로 Redis를 활용해도 가정과 다르게 테스트 결과가 나오는 경우가 있습니다. 단순히 가정으로만 코드만 구현해보는 것이 아닌 테스트로 나의 가정을 검증하는 것이 중요합니다.
    - 가정만이 아닌 수치에 기반한 검증으로 회사에서 나의 의견을 객관적으로 주장하는것이 가장 설득력있는 방법입니다.
- **예외 상황** 만들어보기
    - 예를들어 서버를 구동하고 중산에 Redis를 꺼버린다면 어떤 상황이 발생하는지 인위적으로 상황을 만들어 보는것은 어떨까요?
    - 아니면 굉장히 부하가 많은 커맨드의 연산으로 로직을 구성해서 Redis에 부하를 넣는다면? 어떤 상황이 발생할까요.
    - 여러가지 예외상황을 통해 LRU 캐싱, Distributed Lock, Rate Limiter 등의 Redis 활용 패턴 등을 어떤 상황에 적용해야하는지 감을 잡을 수 있습니다.
    - 어떠한 예외가 발생할지 최대한 경험해보면 실제로 서비스에서 해당 예외 상황이 발생했을때 적합한 패턴을 적용할 수 있을 것입니다.
